<!doctype html>
<html style="height:100%">
<head>
    <link rel="stylesheet" href="http://xa-tools-hornet/css/site.css" type="text/css">
    <link rel="stylesheet" href="http://xa-tools-hornet/css/spreadgrid.css" type="text/css">
    <script src="http://xa-tools-hornet/grunt-scripts/lodash.min.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/jquery.min.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/spreadgrid.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/globalize.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/formatter.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/functions.js"></script>
    <script src="scripts/sparkline.js"></script>

    <style>
        .grid {
            height: 100%;
        }

        .sparkline {
            margin-top: 20px;
        }

        .pie-mark {
            width: 35px;
            height: 10px;
            display: inline-block;
        }

        .pie-mark-owner {
            width: 50px;
            display: inline-block;
        }

        #sales-curve {
            display: inline-block;
            width: 250px;
            height: 150px;
            position: relative;
        }
    </style>
</head>
<body style="height:95%;">

    <div id="grid1" class="grid" style="height:300px;"></div>
    <div class="sparkline">
        <p><b>iPhone5s sales curve</b></p>
        <div style="display:inline-block;">
            <div><div class="pie-mark-owner"><label>Alice</label></div><div class="pie-mark" style="background:#8974A9"></div></div>
            <div><div class="pie-mark-owner"><label>John</label></div><div class="pie-mark" style="background:#919F81"></div></div>
            <div><div class="pie-mark-owner"><label>Alex</label></div><div class="pie-mark" style="background:#D7913E"></div></div>
            <div><div class="pie-mark-owner"><label>Bob</label></div><div class="pie-mark" style="background:#B58091"></div></div>
            <div><div class="pie-mark-owner"><label>Lucy</label></div><div class="pie-mark" style="background:#728BAD"></div></div>
            <div><div class="pie-mark-owner"><label>Chris</label></div><div class="pie-mark" style="background:#CEA722"></div></div>
        </div>
        <div id='sales-curve'></div>
    </div>


    <script>
        $.getJSON("data/salesData.json", function (data) {
            var lineSparklineFormula = '=LINESPARKLINE([quantity],[salesDate])';

            var columns = [
                { id: 'productName', caption: 'productName', dataField: 'productName' },
                {
                    id: 'salesMan',
                    caption: 'salesMan',
                    dataField: 'salesMan',
                    groupHeader: 'sales trend: {{=it.eval("' + lineSparklineFormula + '")}}'
                },
                { id: 'salesDate', caption: 'salesDate', dataField: 'salesDate' },
                { id: 'quantity', caption: 'quantity', dataField: 'quantity' },
                { id: 'unitPrice', caption: 'unitPrice', dataField: 'unitPrice' }
            ];

            var gcGrid = new GcSpread.Views.GcGrid(document.getElementById('grid1'), data, columns, {
                rowHeight: 30,
                allowGrouping: true,
                grouping: [
                    { field: 'productName', collapsed: false, footer: { visible: false } },
                    { field: 'salesMan', collapsed: true, footer: { visible: false } }
                ]
            });

            var calcColumnFormula = 'calculate([salesQuantity], summarize(filter([productName]="iPhone5s"), [salesMan], "salesQuantity", sum([quantity])))';
            var sparkline = gcGrid.data.calculate('=PIESPARKLINE(' + calcColumnFormula + ',"#919F81","#D7913E","#CEA722","#B58091","#8974A9","#728BAD")');
            sparkline.paint(document.getElementById('sales-curve'));
        });
    </script>


</body>
</html>

<!doctype html>
<html style="height:100%">
<head>
    <link rel="stylesheet" href="http://xa-tools-hornet/css/site.css" type="text/css">
    <link rel="stylesheet" href="http://xa-tools-hornet/css/spreadgrid.css" type="text/css">
    <script src="http://xa-tools-hornet/grunt-scripts/lodash.min.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/jquery.min.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/spreadgrid.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/globalize.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/formatter.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/functions.js"></script>
    <script src="scripts/calendarStrategy.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/calendarStrategy.css" type="text/css">

    <style>
        .gc-grid {
            border: 1px solid #CECECE;
        }

        .button-container {
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            margin-right: 30px;
            height: 50px;
        }

        .employee-photo {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            margin-left: 5px;
        }

        .day-event {
            background-color: white;
            color: black;
            font-size: 12px;
            font-family: UbuntuRegular, Ubuntu, 'Bitstream Vera Sans', 'DejaVu Sans', Tahoma, sans-serif;
            box-sizing: border-box;
        }

        .month-event {
            background-color: white;
            color: black;
            font-size: 12px;
            font-family: UbuntuRegular, Ubuntu, 'Bitstream Vera Sans', 'DejaVu Sans', Tahoma, sans-serif;
            box-sizing: border-box;
        }

        .headerTitleEle {
            position: absolute;
            border: 1px solid #CECECE;
            text-align: center;
            font: bold 12px 'arial';
            color: #747473;
            line-height: 30px;
            cursor: pointer;
        }

        .calendarHeader {
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        #daysView, #last {
            border-bottom-left-radius: 5px;
            border-top-left-radius: 5px;
        }

        #monthView, #next {
            border-top-right-radius: 5px;
            border-bottom-right-radius: 5px;
        }

        #last, #next {
            background-repeat: no-repeat;
            background-position: center;
        }

        .headerTitleEle:active {
            background-color: #F0EDE7;
        }

        .doc-example-live {
            height: 900px;
        }

        .event {
            display: inline-block;
            font-size: smaller;
        }

        .event-time {
        }

        .event-title {
            width: 180px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
    </style>
</head>
<body style="height:95%;">

    <div style="height: 100%; position: relative">
        <div class="row button-container ">
            <div class="col-xs-8 col-sm-8 button-container ">
                <div style="height:100%" class="btn-group" rol="group">
                    <button id="normal" type="button" class="btn btn-default" onclick="changeToNormalLayout()">Default</button>
                    <button id="calendar" type="button" class="btn btn-default" onclick="changeToCalendarLayout()">Calendar</button>
                </div>
            </div>
        </div>
        <div class="row button-container " id="calendarCommandPanel">
            <div class="col-xs-4 col-sm-4">
                <div class="btn-group" rol="group">
                    <button id="dayView" type="button" class="btn btn-default" onclick="changeToDayView()">Day</button>
                    <button id="weekView" type="button" class="btn btn-default" onclick="changeToWeekView()">Week</button>
                    <button id="monthView" type="button" class="btn btn-default" onclick="changeToMonthView()">Month</button>
                </div>
            </div>
            <div class="col-xs-2 col-sm-2">
                <div id="title" style="font:400 18px arial,sans-serif;text-align: center;">
                    20
                    Aug 2012-26 Aug 2012
                </div>
            </div>
            <div class="col-xs-3 col-sm-3">
                <button class="btn btn-default" onclick="today()" style="float:right;">Today</button>
            </div>
            <div class="col-xs-3 col-sm-3">
                <div class="btn-group" rol="group" style="float:right;">
                    <div class="btn btn-default" onclick="previous();">
                        <span class="glyphicon glyphicon-arrow-left"></span>
                    </div>
                    <div class="btn btn-default" onclick="next();">
                        <span class="glyphicon glyphicon-arrow-right"></span>
                    </div>
                </div>
            </div>
        </div>

        <div id="gridContainer" style="height:720px;">
            <div id="grid1" style="height:100%;position: relative"></div>
        </div>
    </div>


    <script>
    //#region cal
        var calendaryStrategy;
        var gcGrid;
        var timeFormatter = 'HH:mmtt';
        var dayFormatter = 'MMMM d';

        var columns = [
            { id: 'topic', dataField: 'topic' },
            { id: 'start', dataField: 'start', format: timeFormatter },
            { id: 'end', dataField: 'end', format: timeFormatter },
            { id: 'speaker', dataField: 'speaker' }
        ];

        var monthEventTemplate = '<div><span class="event event-title">{{=it.start}} {{=it.topic}}</span></div>';
        var dayEventTemplate = '<div><div>{{=it.start}}</div><div>{{=it.topic}}</div></div>';
        $(document).ready(function () {
            $.getJSON("databases/timetable.json", function (data) {
                var items = [];
                $.each(data, function (key, val) {
                    for (var prop in val) {
                        if (prop === 'start' || prop === 'end') {
                            val[prop] = new Date(val[prop]);
                        }
                    }
                }
                );

                calendaryStrategy = new GcSpread.Views.GcGrid.Plugins.CalendarStrategy({
                    viewMode: 'Month',
                    eventStartField: 'start',
                    eventEndField: 'end',
                    startDate: new Date(2015, 5, 1, 8, 0, 0),
                    startTime: new Date(2015, 5, 1, 8, 0, 0),
                    endTime: new Date(2015, 5, 1, 21, 0, 0),
                    colWidth: 200
                });
                gcGrid = new GcSpread.Views.GcGrid(document.getElementById('grid1'), data, columns, {
                    grouping: {
                        field: "start",
                        converter: function (field) {
                            return field.toDateString();
                        }
                    },
                    rowTemplate: monthEventTemplate,
                    groupStrategy: calendaryStrategy
                });

                updateTitle();
            });
        });
 //#endregion
        function changeToNormalLayout() {
            var options = gcGrid.options;
            options.groupStrategy = null;
            options.rowHeight = 24;
            options.rowTemplate = null;
            $('#calendarCommandPanel').hide();

            var container = document.getElementById('gridContainer');
            container.style.height = '790px';
            gcGrid.invalidate();
        }

        function changeToCalendarLayout() {
            gcGrid.options.groupStrategy = calendaryStrategy;
            $('#calendarCommandPanel').show();

            var container = document.getElementById('gridContainer');
            container.style.height = '720px';
            gcGrid.invalidate();
        }

        function getDay(currentDate, daysCount) {
            var date = new Date(currentDate);
            var timeSpan = 1000 * 60 * 60 * 24 * (daysCount ? daysCount : 1);
            date.setTime(date.getTime() + timeSpan);

            return date;
        }

        function getMonth(currentDate, monthCount) {
            var year = currentDate.getFullYear();
            var month = currentDate.getMonth() + monthCount;
            var day = currentDate.getDate();

            if (month == 12) {
                month = 0;
                year += 1;
            } else if (month == -1) {
                month = 11;
                year -= 1;
            }

            return new Date(year, month, day, 0, 0, 0);
        }

        function updateTitle() {
            var options = calendaryStrategy.options;
            var date = options.startDate;
            var title = document.getElementById("title");
            if (options.viewMode === 'Month') {
                var dateFormatter = new GcSpread.Views.GcGrid.Plugins.Formatter.ExcelFormatter('mmmm yyyy');
                title.innerText = dateFormatter.format(date);
            } else {
                var dateFormatter = new GcSpread.Views.GcGrid.Plugins.Formatter.ExcelFormatter('d mmm yyyy');
                title.innerText = dateFormatter.format(date) + '-' + dateFormatter.format(getDay(date, options.displayingDays));
            }

        }


        function previous() {
            var options = calendaryStrategy.options;
            var currentDate = options.startDate;

            if (options.viewMode === 'Month') {
                currentDate = getMonth(currentDate, -1);
            } else {
                currentDate = getDay(currentDate, -7);
            }

            calendaryStrategy.options.startDate = currentDate;
            updateTitle();
            gcGrid.invalidate();
        }

        function next() {
            var options = calendaryStrategy.options;
            var currentDate = options.startDate;
            if (options.viewMode === 'Month') {
                currentDate = getMonth(currentDate, 1);
            } else {
                currentDate = getDay(currentDate, 7);
            }

            calendaryStrategy.options.startDate = currentDate;
            updateTitle();
            gcGrid.invalidate();
        }

        function today() {
            var currentDate = new Date();

            calendaryStrategy.options.startDate = currentDate;
            updateTitle();
            gcGrid.invalidate();
        }

        function changeToDayView() {
            var options = gcGrid.options;
            options.rowHeight = 50;
            options.rowTemplate = dayEventTemplate;
            calendaryStrategy.options.viewMode = 'Day';
            gcGrid.invalidate();
        }

        function changeToWeekView() {
            var options = gcGrid.options;
            options.rowHeight = 50;
            options.rowTemplate = dayEventTemplate;
            calendaryStrategy.options.viewMode = 'Week';
            gcGrid.invalidate();
        }

        function changeToMonthView() {
            var options = gcGrid.options;
            options.rowHeight = 24;
            options.rowTemplate = monthEventTemplate;
            calendaryStrategy.options.viewMode = 'Month';
            gcGrid.invalidate();
        }
    </script>


</body>
</html>

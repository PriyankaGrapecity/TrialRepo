<!doctype html>
<html style="height:100%">
<head>
    <link rel="stylesheet" href="http://xa-tools-hornet/css/site.css" type="text/css">
    <link rel="stylesheet" href="http://xa-tools-hornet/css/spreadgrid.css" type="text/css">
    <script src="http://xa-tools-hornet/grunt-scripts/lodash.min.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/jquery.min.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/spreadgrid.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/globalize.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/formatter.js"></script>
    <script src="http://xa-tools-hornet/grunt-scripts/functions.js"></script>
    <script src="scripts/MasonryLayoutEngine.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css" type="text/css">
    <link rel="stylesheet" href="css/MasonryLayoutEngine.css" type="text/css">

    <style>
        .parameter-panel {
            vertical-align: top;
            display: inline-block;
            height: 25%;
            margin: 5px 10px;
        }

        .block {
            box-sizing: border-box;
            border: 2px solid wheat;
        }

            .block:hover {
                border: 2px solid Chartreuse;
            }
    </style>
</head>
<body style="height:95%;">

    <div style="vertical-align:top;">
        <div class="parameter-panel">
            <b>keep order:</b>
            <p>
                <input type="range" id="keep-order" name="keep order" min="0" max="1" style="width:100px" value="0" onchange="syncValue('keep-order')">
                <span id="keep-order-indicator">OFF</span>
            </p>
            <b>gutter:</b>
            <p>
                <input type="range" id="gutter" name="gutter" min="0" max="50" style="width:200px" value="0" onchange="syncValue('gutter')">
                <span id="gutter-indicator">0</span>
            </p>
        </div>
        <div class="parameter-panel">
            <b>row height:</b>
            <p>
                <input type="range" id="row-height" name="row height" min="1" max="200" style="width:200px" value="1" onchange="syncValue('row-height')">
                <span id="row-height-indicator">1</span>
            </p>
            <b>column width:</b>
            <p>
                <input type="range" id="column-width" name="column width" min="1" max="200" style="width:200px" value="1" onchange="syncValue('column-width')">
                <span id="column-width-indicator">1</span>
            </p>
        </div>
        <div class="parameter-panel">
            <p>
                <button id="metro" onclick="changeDataSet('metroData')">metro</button>
                <button id="pinterest" onclick="changeDataSet('pinterestData')">pinterest</button>
                <button id="random" onclick="changeDataSet('randomData')">random</button>
            </p>
        </div>
    </div>
    <div id="grid1" style="height:75%"></div>
    <template id='rowTemplate'>
        <div data-column="block"></div>
    </template>


    <script>
        var gcGrid;
        var columns = [
            { id: 'block', name: 'block', dataField: 'block', presenter: '<div class="block" style="width:{{=it.block.width}}px;height:{{=it.block.height}}px;background-color:{{=it.currentColor}};"></div>' },
            { id: 'currentColor', name: 'currentColor', dataField: 'currentColor', visible: false },
            { id: 'color', name: 'color', dataField: 'color', visible: false },
            { id: 'darkerColor', name: 'darkerColor', dataField: 'darkerColor', visible: false }
        ];

        var colors = ['chocolate', 'DarkOrchid', 'DarkGreen', 'CadetBlue'];
        var darkerColors = ['#542A0C', '#4C1966', '#003200', '#304F50'];
        var data = [];
        var pinterestData = [];
        var metroData = [];
        var randomData = [];

        for (var i = 0; i < 80; i++) {
            //to control the probability
            var tempFactor = Math.ceil(Math.random() * 13);
            var sideLength = tempFactor < 2 ?
                160 :
                tempFactor < 5 ?
                    80 : 40;
            metroData.push({
                width: sideLength,
                height: sideLength
            });
            pinterestData.push({
                width: 100,
                height: Math.ceil(Math.random() * 3 + 3) * 20
            });
            randomData.push({
                width: Math.ceil(Math.random() * 3) * 40,
                height: Math.ceil(Math.random() * 3) * 40
            });
            data.push({
                block: {
                    width: metroData[i].width,
                    height: metroData[i].height
                },
                size: 'small',
                currentColor: colors[i % colors.length],
                color: colors[i % colors.length],
                darkerColor: darkerColors[i % colors.length]
            })
        }

        $(document).ready(function () {
            gcGrid = new GcSpread.Views.GcGrid(document.getElementById('grid1'), data, columns, new GcSpread.Views.GcGrid.Plugins.MasonryLayoutEngine({
                rowTemplate: '#rowTemplate',
                keepOrder: false
            }));
            gcGrid.onMouseClick.addHandler(handleMouseClick);
        });

        function syncValue(id) {
            var bar = document.getElementById(id);
            var indicator = document.getElementById(id + '-indicator');
            var value;
            switch (id) {
                case 'keep-order':
                    indicator.innerHTML = bar.value == 0 ? 'OFF' : 'ON';
                    value = bar.value == 0 ? false : true;
                    gcGrid.layoutEngine.options.keepOrder = value;
                    break;
                case 'gutter':
                    value = indicator.innerHTML = bar.value;
                    gcGrid.layoutEngine.options.gutter = parseInt(value);
                    break;
                case 'row-height':
                    value = indicator.innerHTML = bar.value;
                    gcGrid.layoutEngine.options.rowHeight = parseInt(value);
                    break;
                case 'column-width':
                    value = indicator.innerHTML = bar.value;
                    gcGrid.layoutEngine.options.columnWidth = parseInt(value);
                    break;
            }
            gcGrid.invalidate();
        }

        function changeDataSet(name) {
            var currData = window[name];
            data.forEach(function (item, index) {
                var factor = item.size === 'small' ? 1 : 2;
                item.block.width = currData[index].width * factor;
                item.block.height = currData[index].height * factor;
            });
            gcGrid.invalidate();
        }

        function handleMouseClick(sender, event) {
            var grid = sender;
            var hitTestInfo = grid.layoutEngine.hitTest(event);
            var item;
            var groups = grid.data.groups;
            if (groups) {
                var groupInfo = hitTestInfo.groupInfo;
                var path = groupInfo.path;
                var currentGroup = groups[path[0]];
                for (var i = 1, len = path.length; i < len; i++) {
                    currentGroup = currentGroup.children[path[i]];
                }
                var row = groupInfo.row;
                if (row > -1) {
                    item = currentGroup.getItem(row);
                }
            } else {
                row = hitTestInfo.row;
                if (row > -1) {
                    item = grid.getDataItem(row);
                }
            }
            if (item) {
                toggleSize(item);
                grid.invalidate();
            }
        }

        function toggleSize(item) {
            if (item.size === 'small') {
                item.block.width *= 2;
                item.block.height *= 2;
                item.size = 'large';
                item.currentColor = item.darkerColor;
            } else {
                item.block.width /= 2;
                item.block.height /= 2;
                item.size = 'small';
                item.currentColor = item.color;
            }
        }
    </script>


</body>
</html>
